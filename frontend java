import java.util.*;
import javax.swing.*;
import java.awt.*;
import java.io.*;

/* =========================
   SIMPLE JSON OBJECT CLASS
   ========================= */
class JSONObject {
    private Map<String, String> data = new HashMap<>();

    public void put(String k, String v) {
        data.put(k, v);
    }

    @Override
    public String toString() {
        StringBuilder sb = new StringBuilder("{");
        int i = 0;
        for (String k : data.keySet()) {
            sb.append("\"").append(k).append("\":\"")
              .append(data.get(k)).append("\"");
            if (i++ < data.size() - 1) sb.append(",");
        }
        sb.append("}");
        return sb.toString();
    }
}

/* =========================
   LOGIN SCREEN (MAIN CLASS)
   ========================= */
public class LoginScreen extends JFrame {

    private static final String DATA_DIR =
            "C:\\Users\\husss\\OneDrive\\Documents\\NetBeansProjects\\DSA PROEJCT\\CrimeNetworkAnalyzer\\data\\";
    private static final String USERS_FILE = DATA_DIR + "users.txt";

    public LoginScreen() {

        new File(DATA_DIR).mkdirs();

        setTitle("Crime Network Analyzer - Login");
        setSize(500, 400);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLocationRelativeTo(null);

        JPanel panel = new JPanel(new GridLayout(7, 1, 10, 10));
        panel.setBorder(BorderFactory.createEmptyBorder(30, 50, 30, 50));

        JLabel title = new JLabel("CRIME NETWORK ANALYZER", JLabel.CENTER);
        title.setFont(new Font("Arial", Font.BOLD, 20));

        JTextField userField = new JTextField();
        JPasswordField passField = new JPasswordField();

        JButton loginBtn = new JButton("LOGIN");
        JLabel status = new JLabel("", JLabel.CENTER);

        panel.add(title);
        panel.add(new JLabel("Username:"));
        panel.add(userField);
        panel.add(new JLabel("Password:"));
        panel.add(passField);
        panel.add(loginBtn);
        panel.add(status);

        loginBtn.addActionListener(e -> {
            String u = userField.getText().trim();
            String p = new String(passField.getPassword());

            String[] result = authenticate(u, p);
            if (result != null) {
                dispose();
                new CrimeNetworkAnalyzer(result[0], result[1]);
            } else {
                status.setText("Invalid credentials!");
                status.setForeground(Color.RED);
            }
        });

        add(panel);
        initializeUsers();
        setVisible(true);
    }

    private void initializeUsers() {
        File f = new File(USERS_FILE);
        if (!f.exists()) {
            try (PrintWriter w = new PrintWriter(new FileWriter(f))) {
                w.println("admin|admin123|admin");
                w.println("officer1|pass123|officer");
            } catch (IOException ignored) {}
        }
    }

    private String[] authenticate(String u, String p) {
        try (BufferedReader r = new BufferedReader(new FileReader(USERS_FILE))) {
            String line;
            while ((line = r.readLine()) != null) {
                String[] x = line.split("\\|");
                if (x[0].equals(u) && x[1].equals(p))
                    return new String[]{x[0], x[2]};
            }
        } catch (IOException ignored) {}
        return null;
    }

    // Application Entry Point
    public static void main(String[] args) {
        SwingUtilities.invokeLater(LoginScreen::new);
    }
}

/* =========================
   MAIN APPLICATION WINDOW
   ========================= */
class CrimeNetworkAnalyzer extends JFrame {

    protected final String currentUser;
    protected final String role;
    protected JTabbedPane tabs;

    public CrimeNetworkAnalyzer(String user, String role) {

        this.currentUser = user;
        this.role = role;

        setTitle("Crime Network Analyzer");
        setSize(1100, 750);
        setDefaultCloseOperation(EXIT_ON_CLOSE);
        setLocationRelativeTo(null);

        JPanel header = new JPanel(new BorderLayout());
        header.setBorder(BorderFactory.createEmptyBorder(10, 10, 10, 10));

        JLabel title = new JLabel("CRIME NETWORK ANALYZER");
        title.setFont(new Font("Arial", Font.BOLD, 24));

        JLabel userLbl = new JLabel("User: " + user + " (" + role + ")");
        userLbl.setFont(new Font("Arial", Font.PLAIN, 14));

        header.add(title, BorderLayout.WEST);
        header.add(userLbl, BorderLayout.EAST);

        tabs = new JTabbedPane();

        if (role.equals("admin")) {
            tabs.add("Dashboard", new JPanel());
            tabs.add("Manage Users", new JPanel());
        } else {
            tabs.add("My Cases", new JPanel());
        }

        add(header, BorderLayout.NORTH);
        add(tabs, BorderLayout.CENTER);
        setVisible(true);
    }
}
