#include <iostream>
#include <map>
#include <vector>
#include <stack>
#include <set>
#include <fstream>
#include <sstream>

using namespace std;

// Graph Node
struct Node {
    string id;
    string name;
    string type;
    map<string, string> attributes;
};

// Graph Class
class CrimeGraph {
private:
    map<string, Node> nodes;
    map<string, vector<pair<string, string>>> adjList;

public:
    void addNode(string id, string name, string type, map<string, string> attrs) {
        Node node;
        node.id = id;
        node.name = name;
        node.type = type;
        node.attributes = attrs;
        nodes[id] = node;
        adjList[id]; // initialize adjacency list
    }

    void addEdge(string from, string to, string relation) {
        if (nodes.count(from) && nodes.count(to)) {
            adjList[from].push_back({to, relation});
            adjList[to].push_back({from, relation});
        }
    }

    string listAllNodes() {
        stringstream ss;
        for (auto &p : nodes) {
            ss << p.second.id << " - " << p.second.name << endl;
        }
        return ss.str();
    }

    string displayGraph() {
        stringstream ss;
        for (auto &p : adjList) {
            for (auto &e : p.second) {
                ss << p.first << " <-> " << e.first
                   << " [" << e.second << "]" << endl;
            }
        }
        return ss.str();
    }

    // ðŸ”¹ DFS using Stack (Merged Function)
    string dfs(string start) {
        stack<string> st;
        map<string, bool> visited;
        stringstream ss;

        if (!nodes.count(start)) {
            return "Start node not found.\n";
        }

        st.push(start);

        while (!st.empty()) {
            string cur = st.top();
            st.pop();

            if (!visited[cur]) {
                visited[cur] = true;
                ss << cur << " ";

                for (auto &n : adjList[cur]) {
                    if (!visited[n.first]) {
                        st.push(n.first);
                    }
                }
            }
        }
        return ss.str();
    }
};

int main() {
    CrimeGraph graph;

    graph.addNode("S1", "Ali", "suspect", {});
    graph.addNode("L1", "Market", "location", {});
    graph.addNode("W1", "Shopkeeper", "witness", {});

    graph.addEdge("S1", "L1", "visited");
    graph.addEdge("L1", "W1", "saw");

    cout << "Graph:\n";
    cout << graph.displayGraph() << endl;

    cout << "DFS Traversal from S1:\n";
    cout << graph.dfs("S1") << endl;

    return 0;
}
